<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Development  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="Development  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">MongoSwift Docs</a> (99% documented)</p>
        <p class="header-right"><a href="dash-feed://https%3A%2F%2Fmongodb%2Egithub%2Eio%2Fmongo%2Dswift%2Ddriver%2Fdocsets%2FMongoSwift%2Exml"><img src="img/dash.png"/>Install in Dash</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">MongoSwift Reference</a>
        <img id="carat" src="img/carat.png" />
        Development  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="development.html">Development</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/BsonDecoder.html">BsonDecoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/BsonEncoder.html">BsonEncoder</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ClientSession.html">ClientSession</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DocumentIterator.html">DocumentIterator</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes.html#/s:10MongoSwift15DocumentStorageC">DocumentStorage</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MongoClient.html">MongoClient</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MongoCollection.html">MongoCollection</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MongoCursor.html">MongoCursor</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MongoDatabase.html">MongoDatabase</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MongoSwift.html">MongoSwift</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ReadConcern.html">ReadConcern</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ReadConcern/Level.html">– Level</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ReadPreference.html">ReadPreference</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ReadPreference/Mode.html">– Mode</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/WriteConcern.html">WriteConcern</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/WriteConcern/W.html">– W</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/BsonType.html">BsonType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/CursorType.html">CursorType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/Hint.html">Hint</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/MongoError.html">MongoError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/MongoEventType.html">MongoEventType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ReturnDocument.html">ReturnDocument</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ServerType.html">ServerType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TopologyType.html">TopologyType</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/Array.html">Array</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Bool.html">Bool</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Date.html">Date</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Double.html">Double</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int.html">Int</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int32.html">Int32</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int64.html">Int64</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/NSRegularExpression.html">NSRegularExpression</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/String.html">String</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/BsonValue.html">BsonValue</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/MongoEvent.html">MongoEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols.html#/s:10MongoSwift10WriteModelP">WriteModel</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/AggregateOptions.html">AggregateOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/AnyBsonValue.html">AnyBsonValue</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Binary.html">Binary</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Binary/Subtype.html">– Subtype</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/BulkWriteOptions.html">BulkWriteOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/BulkWriteResult.html">BulkWriteResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ClientOptions.html">ClientOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CodeWithScope.html">CodeWithScope</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CollectionOptions.html">CollectionOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CommandFailedEvent.html">CommandFailedEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CommandStartedEvent.html">CommandStartedEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CommandSucceededEvent.html">CommandSucceededEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ConnectionId.html">ConnectionId</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CountOptions.html">CountOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CreateCollectionOptions.html">CreateCollectionOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/CreateIndexOptions.html">CreateIndexOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DatabaseOptions.html">DatabaseOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Decimal128.html">Decimal128</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DeleteManyModel.html">DeleteManyModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DeleteOneModel.html">DeleteOneModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DeleteOptions.html">DeleteOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DeleteResult.html">DeleteResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DistinctOptions.html">DistinctOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Document.html">Document</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DropIndexOptions.html">DropIndexOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/EstimatedDocumentCountOptions.html">EstimatedDocumentCountOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FindOneAndDeleteOptions.html">FindOneAndDeleteOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FindOneAndReplaceOptions.html">FindOneAndReplaceOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FindOneAndUpdateOptions.html">FindOneAndUpdateOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/FindOptions.html">FindOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/IndexModel.html">IndexModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/IndexOptions.html">IndexOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/InsertManyOptions.html">InsertManyOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/InsertManyResult.html">InsertManyResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/InsertOneModel.html">InsertOneModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/InsertOneOptions.html">InsertOneOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/InsertOneResult.html">InsertOneResult</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ListCollectionsOptions.html">ListCollectionsOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ListDatabasesOptions.html">ListDatabasesOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/MaxKey.html">MaxKey</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/MinKey.html">MinKey</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ObjectId.html">ObjectId</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RegularExpression.html">RegularExpression</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ReplaceOneModel.html">ReplaceOneModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ReplaceOptions.html">ReplaceOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/RunCommandOptions.html">RunCommandOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ServerClosedEvent.html">ServerClosedEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ServerDescription.html">ServerDescription</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ServerDescriptionChangedEvent.html">ServerDescriptionChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ServerHeartbeatFailedEvent.html">ServerHeartbeatFailedEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ServerHeartbeatStartedEvent.html">ServerHeartbeatStartedEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ServerHeartbeatSucceededEvent.html">ServerHeartbeatSucceededEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ServerOpeningEvent.html">ServerOpeningEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SessionOptions.html">SessionOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Timestamp.html">Timestamp</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/TopologyClosedEvent.html">TopologyClosedEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/TopologyDescription.html">TopologyDescription</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/TopologyDescriptionChangedEvent.html">TopologyDescriptionChangedEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/TopologyOpeningEvent.html">TopologyOpeningEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/UpdateManyModel.html">UpdateManyModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/UpdateOneModel.html">UpdateOneModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/UpdateOptions.html">UpdateOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/UpdateResult.html">UpdateResult</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:10MongoSwift21CountDocumentsOptionsa">CountDocumentsOptions</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='swift-driver-development-guide' class='heading'>Swift Driver Development Guide</h1>
<h2 id='index' class='heading'>Index</h2>

<ul>
<li><a href="#things-to-install">Things to Install</a></li>
<li><a href="#the-code">The Code</a></li>
<li><a href="#building">Building</a></li>
<li><a href="#running-tests">Running Tests</a></li>
<li><a href="#writing-and-generating-documentation">Writing and Generating Documentation</a></li>
<li><a href="#linting">Linting</a></li>
<li><a href="#workflow">Workflow</a></li>
<li><a href="#resources">Resources</a></li>
</ul>
<h2 id='things-to-install' class='heading'>Things to install</h2>

<ul>
<li><a href="https://swiftenv.fuller.li/en/latest/installation.html">swiftenv</a>: a command-line tool that allows easy installation of and switching between versions of Swift.

<ul>
<li>Use this to install Swift 4.0 if you don&rsquo;t have it already.</li>
</ul></li>
<li><a href="https://github.com/realm/jazzy#installation">jazzy</a>: the tool we use to generate documentation.</li>
<li><a href="https://github.com/realm/SwiftLint#using-homebrew">swiftlint</a>: the Swift linter we use.</li>
<li><a href="http://mongoc.org/libmongoc/current/api.html">libmongoc</a>: the MongoDB C driver, which this library wraps. See the installation instructions provided in our <a href="README.md#first-install-the-mongodb-c-driver">README</a> or on the <a href="http://mongoc.org/libmongoc/current/installing.html">libmongoc docs</a>.</li>
</ul>
<h2 id='the-code' class='heading'>The code</h2>

<p>You should clone this repository, as well as the <a href="https://github.com/mongodb/specifications">MongoDB Driver specifications</a>. 
Since this library wraps the MongoDB C Driver, we also recommend cloning <a href="https://github.com/mongodb/mongo-c-driver">mongodb/mongo-c-driver</a> so you have the source code and documentation easily accessible. </p>
<h2 id='building' class='heading'>Building</h2>
<h3 id='from-the-command-line' class='heading'>From the Command line</h3>

<p>Run <code>make</code> from the project&rsquo;s root directory. </p>
<h3 id='in-xcode' class='heading'>In Xcode</h3>

<p>We do not provide or maintain an already-generated <code>.xcodeproj</code> in our repository. Instead, you must generate it locally.</p>

<p><strong>To generate the <code>.xcodeproj</code> file</strong>:</p>

<ol>
<li>Install the Ruby gem <code>xcodeproj</code> with <code>gem install xcodeproj</code> (you may need to <code>sudo</code>)</li>
<li>Run <code>make project</code></li>
<li>You&rsquo;re ready to go! Open <code>MongoSwift.xcodeproj</code> and build and test as normal.</li>
</ol>

<p>Why is this necessary? The project requires a customized <q>copy resources</q> build phase to include various test <code>.json</code> files. By default, this phase is not included when you run <code>swift package generate-xcodeproj</code>. So <code>make project</code> first generates the project, and then uses <code>xcodeproj</code> to manually add the files to the appropriate targets (see <code>add_json_files.rb</code>). </p>
<h2 id='running-tests' class='heading'>Running Tests</h2>

<p><strong>NOTE</strong>: Several of the tests require a mongod instance to be running on the default host/port, <code>localhost:27017</code>.</p>

<p>Additionally, please note that each benchmark test runs for a minimum of 1 minute and therefore <strong>the entire benchmark suite will take around 20-30 minutes to complete</strong>.</p>

<p>You can run tests from Xcode as usual. If you prefer to test from the command line, keep reading.</p>
<h3 id='from-the-command-line' class='heading'>From the Command Line</h3>

<p>Tests can be run from the command line with <code>make test</code>. By default, this will run all the tests excluding the benchmarks.</p>

<p>To only run particular tests, use the <code>FILTER</code> environment variable, which is passed as the <code>filter</code> argument to <code>swift test</code>. This will run test cases with names matching a regular expression, formatted as follows: <code>&lt;test-target&gt;.&lt;test-case&gt;</code> or <code>&lt;test-target&gt;.&lt;test-case&gt;/&lt;test&gt;</code>.</p>

<p>For example, <code>make test FILTER=ClientTests</code> will run <code>MongoSwiftTests.ClientTests/*</code>. Or, <code>make test FILTER=testInsertOne</code> will only run <code>MongoSwiftTests.CollectionTests/testInsertOne</code>. </p>

<p>To run all of the benchmarks, use <code>make benchmark</code> (equivalent to <code>FILTER=MongoSwiftBenchmarks</code>). To run a particular benchmark, use the <code>FILTER</code> environment variable to specify the name. To have the benchmark results all printed out at the end, run with <code>make benchmark | python Tests/MongoSwiftBenchmarks/benchmark.py</code>.</p>
<h3 id='diagnosing-backtraces-on-linux' class='heading'>Diagnosing Backtraces on Linux</h3>

<p><a href="https://bugs.swift.org/browse/SR-755">SWIFT-755</a> documents an outstanding problem on Linux where backtraces do not contain debug symbols. As discussed in <a href="https://stackoverflow.com/a/44956167/162228">this Stack Overflow thread</a>, a <a href="https://github.com/apple/swift/blob/master/utils/symbolicate-linux-fatal"><code>symbolicate-linux-fatal</code></a> script may be used to add symbols to an existing backtrace. Consider the following:</p>
<pre class="highlight plaintext"><code>$ swift test --filter CrashingTest &amp;&gt; crash.log
$ symbolicate-linux-fatal /path/to/MongoSwiftPackageTests.xctest crash.log
</code></pre>

<p>This will require you to manually provide the path to the compiled test binary (e.g. <code>.build/x86_64-unknown-linux/debug/MongoSwiftPackageTests.xctest</code>).</p>
<h2 id='writing-and-generating-documentation' class='heading'>Writing and Generating Documentation</h2>

<p>We document new code as we write it. We use C-style documentation blocks (<code>/** ... */</code>) for documentation longer than 3 lines, and triple-slash (<code>///</code>) for shorter documentation. 
Comments that are <em>not</em> documentation should use two slashes (<code>//</code>).</p>

<p>Our documentation site is automatically generated from the source code using <a href="https://github.com/realm/jazzy#installation">jazzy</a>. 
To regenerate the files after making changes, run <code>make documentation</code> from the project&rsquo;s root directory. You can then inspect the changes to the site by opening the files in <code>/docs</code> in your web browser.</p>
<h2 id='linting' class='heading'>Linting</h2>

<p>We use <a href="https://github.com/realm/SwiftLint#using-homebrew">swiftlint</a> for linting. You can see our configuration in the <code>.swiftlint.yml</code> file in the project&rsquo;s root directory.  Run <code>swiftlint</code> in the <code>/Sources</code> directory to lint all of our files. Running <code>swiftlint autocorrect</code> will correct some types of violations.</p>
<h3 id='sublime-text-setup' class='heading'>Sublime Text Setup</h3>

<p>If you use Sublime Text, you can get linting violations shown in the editor by installing the packages <a href="https://packagecontrol.io/packages/SublimeLinter">SublimeLinter</a> and <a href="https://packagecontrol.io/packages/SublimeLinter-contrib-swiftlint">SublimeLinter-contrib-swiftlint</a>. </p>
<h2 id='workflow' class='heading'>Workflow</h2>

<ol>
<li>Create a feature branch, named by the corresponding JIRA ticket if exists; for example, <code>SWIFT-30</code>.</li>
<li>Do your work on the branch.</li>
<li>Open a pull request on the repository. Make sure you have rebased your branch onto the latest commits on <code>master</code>.</li>
</ol>

<p>Once you get the required approvals and your code passes all tests:</p>

<ol>
<li>Rebase on master again if needed.</li>
<li>Build and rerun tests.</li>
<li>If your code includes any new documentation or changes to documentation, run <code>make documentation</code> and commit the resulting changes.</li>
<li>Squash all commits into a single, descriptive commit method, formatted as: <code>TICKET-NUMBER: Description of changes</code>. For example, <code>SWIFT-30: Implement WriteConcern type</code>.</li>
<li>Merge it, or if you don&rsquo;t have permissions, ask someone to merge it for you.</li>
</ol>
<h2 id='resources' class='heading'>Resources</h2>
<h3 id='swift' class='heading'>Swift</h3>

<ul>
<li><a href="https://docs.swift.org/swift-book/LanguageGuide/TheBasics.html">Swift Language Guide</a></li>
<li><a href="https://developer.apple.com/documentation/swift">Swift Standard Library docs</a></li>
</ul>
<h3 id='mongodb-and-drivers' class='heading'>MongoDB and Drivers</h3>

<ul>
<li><a href="https://mongodb.github.io/mongo-swift-driver/">MongoSwift docs</a></li>
<li><a href="http://mongoc.org/libmongoc/current/index.html">libmongoc docs</a></li>
<li><a href="http://mongoc.org/libbson/current/index.html">libbson docs</a></li>
<li><a href="https://docs.mongodb.com/">MongoDB docs</a></li>
<li><a href="https://github.com/mongodb/specifications">Driver specifications</a></li>
</ul>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2018 <a class="link" href="https://github.com/mongodb/mongo-swift-driver" target="_blank" rel="external">Matt Broadstone and Kaitlin Mahar</a>. All rights reserved. (Last updated: 2018-08-21)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
